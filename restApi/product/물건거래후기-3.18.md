---
REST API - Chat created by MS (21-01-15)
---


# 거래후기(한 개) 조회

거래후기는 모두가 판매자, 구매자 모두 볼 수 있다.
또란 거래후기를 볼 수 있는 페이지는(직접 클릭하여 보는 부분, 해당 api를 이용하여 구매후기를 조회하는 부분을 의미함)
내거래정보와 채팅방 뿐이다. 채팅방의 경우는 판매자의 입장에서 어떤 사람이 내 물건에 대해서 후기를 남겼는 지 조회할 수 있다.

결론은 
채팅방에서 내가 남긴 거래후기(구매자입장)를 볼때나 "닉네임"이 남긴 거래후기 보기(판매자입장)를 눌러 남긴 구매후기를 볼 떄
아래와 같은 엔드포인트로 거래후기 정보를 조회한다.
myItem 의 구매물품 중 구매후기를 작성한 물건에 한해서 개별물품의 [거래후기보기] 를 클릭시 아래의 엔드포인트로 
서버로 요청해 해당 물건의 거래후기를 볼 수 있다.

다만, 
거래후기역시 상대방의 어떤 상태에 놓여있는 가에 따라서 응답값이 달리 내려온다.
즉, 판매자/구매자 상관없이 상대방이 차단/유저제재/탈퇴 또는 해당 물건이 블라인드조치/삭제 되었을 경우에는 구매후기를 볼 수 없는 데(물건에 종속)
따라서 이 경우에 해당되면 예외 응답값을 내려주며 구매후기는 더 이상 조회불가능 하며 그에 따른 예외 응답값을 내려주고 있다.



### 수정사항 3.18 예외사항 추가
거래후기 조회시 거래조회를 하려고 할 때 구매한 물건이 블라인드 처리되었는 지 삭제되었는지
또는 상대방이 유저제재/차단/탈퇴 되었는 지 상태에 따라 다른 예외응답값이 내려온다.

총 5개가 있으며 해당 예외값이 올때는 적절한 UI 처리를 하면 될 듯하다.
가령 채팅방에서 조회해서 해당 에러가 뜰 경우는 채팅방의 UI를 비활성화 처리하면 될 것이고, 내거래정보에서 구매물건 쪽에서 조회하려고 하는 데 해당
에러가 뜬다면 특별한 조치를 하지 않거나 아니면 새로고침을 시키는 방법이 있을 것이다.

1. 거래후기 조회시 물건이 삭제되었을 경우(productStatus=1 or 완전히 삭제)
2. 거래후기 조회시 물건이 관리자에 의해 블라인드 처리되었을 때(productStatus=2)
3. (판매자/구매자 입장) 상대방(여기서 말하는 상대방은, 판매자입장이면 구매후기조회를 클릭할 때 후기를 남긴 사람을 뜻하고 구매자입장이면 구매후기를 남긴 물건의 소유자를 뜻한다.)이 이용제재받고 있을 때
4. (판매자/구매자 입장) 차단관계에 있을 때
5. (판매자/구매자 입장) 모두 차단관계일 때(나도 차단, 상대방도 나를 차단 -> 3번을 따라감)

자세한 응답값은 아래에 나와있다.



**URL** : `/api/product/{product-id}/comment` 

**Method** : `GET`

**Authentication required** : `yes`

**Data** : `None`

## Success Responses

___
 
**Code** : `200 OK`

**Content**

`message`: 응답 메시지 

`status`: 응답 상태 

`data`: 구매자 정보 및 거래 후기 내용

​		`review_nickname`: 구매자 닉네임

​		`review_comment`: 구매자 거래 후기 내용

​		`review_date`: 구매자 거래 후기 작성한 날짜

**example**

```json
{
    "message": "product comment",
    "status": 200,
    "data": {
        "review_nickname": "fgh0296",
        "review_comment": "정말정말 친절하십니다!! 또 거래하고 싶을 정도 입니다!",
        "review_date": "2021-01-15T23:59:51"
    }
}
```

## 예외사항 (success response) 총5가지가 있다.

1. 거래후기 조회시 물건이 삭제되었을 경우
2. 거래후기 조회시 물건이 관리자에 의해 블라인드 처리되었을 때 
3. 상대방이 이용제재를 받고 있을 때
4. 차단관계에 있을 때
5. 서로 모두 차단관계일 때(나도 차단, 상대방도 나를 차단 -> 3번을 따라감)


### 1.거래후기 조회시 물건이 삭제되었을 경우(productStatus=1 or 완전히 삭제)

```json

{
    "statusCode": 404,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "물건이 존재하지 않습니다.",
    "description": "uri=/api/product/20/comment"
}

```

### 2. 거래후기 조회시 물건이 관리자에 의해 블라인드 처리되었을 때(productStatus=2)

```json

{
    "statusCode": 404,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "해당물건은 관리자에 의해 블라인드 처리되었습니다.",
    "description": "uri=/api/product/20/comment"
}

```

### 3. (판매자/구매자 입장) 상대방(여기서 말하는 상대방은, 판매자입장이면 구매후기조회를 클릭할 때 후기를 남긴 사람을 뜻하고 구매자입장이면 구매후기를 남긴 물건의 소유자를 뜻한다.)이 이용제재받고 있을 때


```json

{
    "statusCode": 400,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "관리자로 부터 이용제재 받고 있는 유저입니다.(상대방)",
    "description": "uri=/api/product/20/comment"
}

```


### 4. (판매자/구매자 입장) 차단관계에 있을 때

1) 구매자입장에서 내가 올린 구매후기를 보는 경우

1_1 내(구매자)가 상대방(판매자)을 차단했을 경우

```json

{
  "statusCode": 400,
  "timestamp": "2021-03-18T05:42:46.242+00:00",
  "message": "차단한 유저에게 남긴 구매후기를 볼 수 없습니다.",
  "description": "uri=/api/product/20/comment"
}

```


1_2 상대방(판매자)이 나(구매자)를 차단했을 경우

```json

{
  "statusCode": 400,
  "timestamp": "2021-03-18T05:42:46.242+00:00",
  "message": "차단당한 유저로부터는 내가 남긴 구매후기를 볼 수 없습니다.",
  "description": "uri=/api/product/20/comment"
}

```

---


2) 판매자입장에서 구매자가 올린 구매후기를 보는 경우


2_1 내(판매자)가 상대방(구매자)를 차단했을 경우

```json

{
  "statusCode": 400,
  "timestamp": "2021-03-18T05:42:46.242+00:00",
  "message": "차단한 유저의 구매후기를 볼 수 없습니다.",
  "description": "uri=/api/product/20/comment"
}

```



2_2 상대방(구매자)이 나를 차단했을 경우

```json

{
  "statusCode": 400,
  "timestamp": "2021-03-18T05:42:46.242+00:00",
  "message": "차단당한 유저로부터는 유저가 남긴 구매후기를 볼 수 없습니다.",
  "description": "uri=/api/product/20/comment"
}

```

### 5.(판매자/구매자 입장) 모두 차단관계일 때(나도 차단, 상대방도 나를 차단 -> 3번을 따라감)

이 경우에는 4번의 1번 구매자입장에서 내가 올린 구매후기를 보는 경우를 따라갑니다. 따라서 클라이언트는 그에 맞게 조치를 취하시면 됩니다.







# 거래후기 작성하기

### 수정사항 3.17 예외사항 추가 
거래후기 작성완료 버튼 누를 시
1. 상대방이 탈퇴하였을 경우
2. 상대방이 이용제재 조치 받고 있는 유저일 경우
3. 상대방의 물건이 삭제되었을 경우
4. 상대방의 물건이 관리자에 의해 블라인드 처리 되었을 경우
5. 내가 상대방을 차단했을 경우
6. 상대방이 나를 차단했을 경우
7. 만약 두명 모두 서로를 차단했을 경우(5번을 따라간다.)
ㅁㅁ
채팅방에서 거래완료 후기를 작성한 후에 확인 버튼을 누를 떄 아래의 엔드포인트로 서버로 요청한다.
(또한 추후에) 
내 아이템 페이지에서 구매물품을 볼 수 있는 화면 중 구매후기를 작성하지 않은 물건에 대해서 [거래후기작성] 클릭시
아래의 엔드포인트로 요청하여 거래후기를 작성할 수 있다.

**URL** : `/api/product/{product-id}/comment` 

**Method** : `POST`

**Authentication required** : `yes`

**Request Body** : 
 
 `product_comment` : 거래후기 내용
 
 ```json

{
    "product_comment" : "정말로 친절하세요! 또 거래하고 싶습니다!!" 
}

```

## Success Responses

___
 
**Code** : `201 (created)` 

**Response Header** : 
`location` : `/api/product/{product-id}/comment` , HTTP location 헤더는 보통 새롭게 생성된 자원(201 상태코드)의 위치에
대한 정보를 제공하기 휘새 브라우저를 요청하는 이 상황에서 사용되는 응답헤더이다. 필요한 경우 해당 location 에 있는 엔드포인트에 다시 요청을 하여 
서버로 부터 원하는 정보를 가져올 수 있다.

**Response Body**

Posted successfully



### 예외사항 (response)

거래후기를 남기려고 할 때 구매한 물건이 블라인드 처리되었는 지 삭제되었는지
또는 상대방이 유저제재/차단/탈퇴 되었는 지 상태에 따라 다른 예외응답값이 내려온다.

1. 상대방(판매자)이 이용제재 조치 받고 있는 유저일 경우
2. 상대방(판매자)의 물건이 삭제되었을 경우
3. 상대방(판매자)의 물건(내가 구매후기를 작성하려고 하는 해당 물건)이 관리자에 의해 블라인드 처리 되었을 경우
4. 내가 상대방(판매자)을 차단했을 경우
5. 상대방(판매자)이 나를 차단했을 경우
6. 만약 두명 모두 서로를 차단했을 경우(5번을 따라간다.)

### 1. 상대방(판매자)이 이용제재 조치 받고 있는 유저일 경우

```json

{
    "statusCode": 400,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "관리자로 부터 이용제재 받고 있는 유저입니다.(상대방)",
    "description": "uri=/api/product/20/comment"
}

```


### 2. 상대방(판매자)의 물건이 삭제되었을 경우

```json

{
    "statusCode": 404,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "물건이 존재하지 않습니다.",
    "description": "uri=/api/product/20/comment"
}

```


### 3. 상대방(판매자)의 물건이 관리자에 의해 블라인드 처리 되었을 경우

```json

{
    "statusCode": 400,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "해당물건은 관리자에 의해 블라인드 처리되었습니다.",
    "description": "uri=/api/product/20/comment"
}

```



### 4. 내가 상대방(판매자)을 차단했을 경우


```json

{
    "statusCode": 400,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "차단한 유저에게 거래후기를 남길 수 없습니다.",
    "description": "uri=/api/product/20/comment"
}

```


### 5. 상대방(판매자)이 나를 차단했을 경우(물건을 올린 사람이 나를 차단한 경우)


```json

{
    "statusCode": 400,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "차단당한 유저에게 거래후기를 남길 수 없습니다.",
    "description": "uri=/api/product/20/comment"
}

```


### 6. 만약 두명 모두 서로를 차단했을 경우(5번을 따라감)

```json

{
    "statusCode": 400,
    "timestamp": "2021-03-18T05:42:46.242+00:00",
    "message": "차단한 유저에게 거래후기를 남길 수 없습니다.",
    "description": "uri=/api/product/20/comment"
}

```